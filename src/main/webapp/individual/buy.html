<script>
    function sendbuy(event){
        event.preventDefault();
        let myForm = document.getElementById('buyform');
        let formData = new FormData(myForm);
        const data = {};
        formData.forEach((value, key) => (data[key] = value));

        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
            if(xhr.readyState === 4 && xhr.status === 200){

            }else{

            }
        }

        data["account_id"] = userdata["account_id"];
        console.log(JSON.stringify(data));
        xhr.open('POST', '/HY360_Project_war_exploded/TransactionsAPI');
        xhr.setRequestHeader("Content-type", "application/json");
        xhr.send(JSON.stringify(data));
    }
    var reply
    function loadmerchants(){
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
            if(xhr.readyState === 4 && xhr.status === 200){
                console.log(xhr.responseText);
                reply = JSON.parse(xhr.responseText);
                if(jQuery.isEmptyObject(reply)){
                    $("#merchantselect").disable();
                }else{
                    for(ind in reply["merchants"]){
                        var mer = JSON.parse(reply["merchants"][ind]);
                        var option = "<option value='"+mer["account_id"]+"'>"+mer["name"]+"</option>";
                        $("#merchantselect").append(option);
                    }
                }
            }else{

            }
        }

        xhr.open('GET', '/HY360_Project_war_exploded/MerchantAPI');
        xhr.setRequestHeader("Content-type", "application/json");
        xhr.send();
    }

    $(document).ready(function(){
        loadmerchants();
        if(userdata["company_id"]!=0){
            $("#as_company").show();
        }
    });


</script>
<header>
    <h4>Buy from a specific Merchant</h4>
</header>
<form id="buyform" onsubmit="sendbuy(event);">
    <label>Merchant: </label>
    <select id="merchantselect" name="merchant_id">

    </select>
    <br>
    <label>Ammount: </label>
    <input name="amount" value=0>
    <br>
    <label>Buy as your company: </label>
    <input type="radio" id="as_company" style="display: none;" name="as_company" value="1">
    <br>
    <input type="submit" value="pay">
</form>